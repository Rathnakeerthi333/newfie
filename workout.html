<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RK Fitness · Workout Planner</title>
  <style>
        
        
     * {
         margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    .nav{
        display: flex;
       justify-content: space-between;
       align-items: center;
       padding: 20px 40px;
      background: #111;
      position: sticky;
      top: 0;
       z-index: 1000;
    }
    .log{
        font-size: 15px;
        font-weight: bold;
       color: #ff5722;
    }
    .w{
        color: blanchedalmond;
    }
    :root {
  --bg: black;       /* black background */
  --panel: #141414;    /* dark panel */
  --card: #1e1e1e;     /* inner container */
  --accent: #ff6a00;   /* bright orange */
  --text: #ffffff;     /* white */
  --muted: #bbbbbb;    /* gray for secondary text */
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: "Segoe UI", sans-serif;
  margin: 0;
  padding: 0;
}

.panel {
  background: var(--panel);
  border-radius: 16px;
  padding: 24px;
  max-width: 800px;
  margin: 40px auto;
  box-shadow: 0 0 18px rgba(0, 0, 0, 0.6);
}

.panel h2 {
  margin: 0 0 16px;
  font-size: 24px;
  font-weight: 600;
  color: var(--accent);
}

.tabs {
  display: flex;
  margin-bottom: 20px;
  border-bottom: 2px solid var(--accent);
}

.tab {
  flex: 1;
  text-align: center;
  padding: 10px 0;
  cursor: pointer;
  background: var(--card);
  color: var(--muted);
  transition: all 0.3s;
}

.tab.active {
  background: var(--accent);
  color: var(--text);
  font-weight: 600;
}

.tab:hover {
  background: rgba(255, 106, 0, 0.2);
  color: var(--text);
}

.row, .grid-2 {
  display: flex;
  gap: 20px;
  margin-top: 15px;
  flex-wrap: wrap;
}

.field {
  flex: 1;
  display: flex;
  flex-direction: column;
}

label {
  margin-bottom: 6px;
  font-size: 14px;
  color: var(--accent);
}

input, select {
  background: var(--card);
  border: 1px solid var(--accent);
  padding: 10px;
  border-radius: 8px;
  color: var(--text);
  font-size: 14px;
}

input:focus, select:focus {
  outline: none;
  border-color: #ff8c33;
  box-shadow: 0 0 6px rgba(255, 106, 0, 0.6);
}

.actions {
  margin-top: 20px;
  display: flex;
  gap: 12px;
}

button {
  padding: 10px 16px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

button.primary {
  background: var(--accent);
  color: var(--text);
}

button.primary:hover {
  background: #ff8533;
}

button.ghost {
  background: transparent;
  border: 1px solid var(--accent);
  color: var(--accent);
}

button.ghost:hover {
  background: rgba(255, 106, 0, 0.15);
}

.note {
  font-size: 14px;
  color: var(--muted);
}
.plan {
  background: #141414;
  border-radius: 16px;
  padding: 24px;
  max-width: 900px;
  margin: 40px auto;
  box-shadow: 0 0 18px rgba(0, 0, 0, 0.6);
  color: #fff;
}

.plan h2 {
  color: #ff6a00;
  font-size: 24px;
  font-weight: 600;
}

.plan .p {
  font-size: 14px;
  color: #bbbbbb;
}

.footer-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.footer-actions button {
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.footer-actions button:hover {
  transform: translateY(-2px);
}

.footer-actions button:not(.ghost) {
  background: #ff6a00;
  color: #fff;
}

.footer-actions button:not(.ghost):hover {
  background: #ff8533;
}

.footer-actions .ghost {
  background: transparent;
  border: 1px solid #ff6a00;
  color: #ff6a00;
}

.footer-actions .ghost:hover {
  background: rgba(255, 106, 0, 0.15);
}

.badges {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.badges .badge {
  background: #1e1e1e;
  color: #ff6a00;
  border: 1px solid #ff6a00;
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
}

.week {
  margin-top: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 16px;
}

.week .day {
  background: #1e1e1e;
  border-radius: 12px;
  padding: 16px;
  border: 1px solid #2a2a2a;
  transition: all 0.3s;
}

.week .day:hover {
  border-color: #ff6a00;
  box-shadow: 0 0 8px rgba(255, 106, 0, 0.5);
}

.week .day h3 {
  margin: 0 0 10px;
  font-size: 18px;
  color: #ff6a00;
}

.week .exercise {
  font-size: 14px;
  color: #fff;
  margin: 6px 0;
  display: flex;
  justify-content: space-between;
}

.week .exercise a {
  color: #ff6a00;
  font-size: 13px;
  text-decoration: none;
  transition: color 0.3s;
}

.week .exercise a:hover {
  color: #ff8533;
}

.plan .note {
  font-size: 13px;
  color: #bbbbbb;
  margin-top: 12px;
}
    
        
       </style>

</head>
<body>
  <header>
    <div class="wrap" style="display:flex; align-items:center; justify-content:space-between;">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>RK Fitness · Workout Planner</h1>
          <div class="p">Auto & manual plans · Modern & scientific</div>
        </div>
      </div>
      <div class="badges">
        <span class="mutebadge" id="metricsStatus">No metrics loaded</span>
        <span class="mutebadge">Beta</span>
      </div>
    </div>
  </header>

  <main>
    <!-- Left: Controls -->
    <section class="panel">
      <div class="inner">
        <h2>Plan Mode</h2>
        <div class="tabs" id="modeTabs">
          <div class="tab active" data-mode="auto">Auto (use metrics)</div>
          <div class="tab" data-mode="manual">Manual (choose yourself)</div>
        </div>

        <div id="autoForm">
          <div class="p" style="margin-top:10px">Enter metrics (or they will be auto-loaded if saved from previous pages).</div>
          <div class="row">
            <div class="field">
              <label>Sex</label>
              <select id="sex">
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            </div>
            <div class="field">
              <label>Age (years)</label>
              <input type="number" id="age" placeholder="20" min="10" max="90" />
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label>Height (cm)</label>
              <input type="number" id="height" placeholder="170" min="120" max="230" />
            </div>
            <div class="field">
              <label>Weight (kg)</label>
              <input type="number" id="weight" placeholder="65" min="30" max="200" />
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label>Activity level</label>
              <select id="activity">
                <option value="1.2">Sedentary</option>
                <option value="1.375">Lightly active</option>
                <option value="1.55">Moderately active</option>
                <option value="1.725">Very active</option>
                <option value="1.9">Athlete / Extra active</option>
              </select>
            </div>
            <div class="field">
              <label>Goal</label>
              <select id="goal">
                <option value="recomp">Recomp (balanced)</option>
                <option value="fatloss">Fat loss</option>
                <option value="muscle">Muscle gain</option>
                <option value="athletic">Athletic performance</option>
              </select>
            </div>
          </div>
          <div class="actions">
            <button class="primary" id="genAuto">Generate Auto Plan</button>
            <button class="ghost" id="saveMetrics">Save metrics</button>
          </div>
          <div class="p note" id="metricsPreview" style="margin-top:8px"></div>
        </div>

        <div id="manualForm" style="display:none; margin-top:10px">
          <div class="grid-2">
            <div class="field">
              <label>Category</label>
              <select id="manCategory">
                <option value="bodybuilding">Bodybuilding</option>
                <option value="athletic">Athletic</option>
                <option value="yoga">Yoga</option>
                <option value="home">Home Workout</option>
              </select>
            </div>
            <div class="field">
              <label>Experience</label>
              <select id="manLevel">
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
              </select>
            </div>
          </div>
          <div class="grid-2">
            <div class="field">
              <label>Available days / week</label>
              <select id="manDays">
                <option>3</option>
                <option>4</option>
                <option selected>5</option>
                <option>6</option>
              </select>
            </div>
            <div class="field">
              <label>Equipment</label>
              <select id="manEquip">
                <option value="full">Gym (full)</option>
                <option value="minimal">Minimal (dumbbells/bands)</option>
                <option value="none">No equipment</option>
              </select>
            </div>
          </div>
          <div class="actions">
            <button class="primary" id="genManual">Generate Manual Plan</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Right: Plan -->
    <section class="plan">
      <div class="inner">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap">
          <div>
            <h2 style="margin:0">Weekly Plan</h2>
            <div class="p">Auto-generated based on metrics/goal, or manual selection.</div>
          </div>
          <div class="footer-actions">
            <button id="downloadJson">Download Plan (JSON)</button>
            <button onclick="window.print()">Print</button>
            <button class="ghost" id="resetPlan">Reset</button>
          </div>
        </div>

        <div class="badges" id="planMeta" style="margin-top:10px"></div>
        <div class="week" id="week"></div>
        <div class="note" style="margin-top:12px">Tip: Click ▶ Video on an exercise to open a safe YouTube search for correct form.</div>
      </div>
    </section>
  </main>

  <script>
    // ---------- Utility: metrics, calculations ----------
    const qs = (sel, root=document) => root.querySelector(sel);
    const qsa = (sel, root=document) => [...root.querySelectorAll(sel)];

    function calcBMI(hCm, wKg){ if(!hCm||!wKg) return null; const m=hCm/100; return +(wKg/(m*m)).toFixed(1); }
    function calcBMR(sex, w, h, age){ if(!sex||!w||!h||!age) return null; const s = sex==='male' ? 5 : -161; return Math.round(10*w + 6.25*h - 5*age + s); }
    function calcTDEE(bmr, activity){ if(!bmr||!activity) return null; return Math.round(bmr*parseFloat(activity)); }

    function loadMetrics(){
      try{
        const saved = JSON.parse(localStorage.getItem('rk_metrics')||'null');
        if(saved){
          ['sex','age','height','weight','activity'].forEach(k=>{ const el=qs('#'+k); if(el&&saved[k]!=null){ el.value = saved[k]; }});
          qs('#metricsStatus').textContent = 'Metrics loaded from device';
          return saved;
        }
      }catch(e){}
      qs('#metricsStatus').textContent = 'No metrics loaded';
      return null;
    }
    function saveMetrics(){
      const data = {
        sex: qs('#sex').value,
        age: +qs('#age').value,
        height: +qs('#height').value,
        weight: +qs('#weight').value,
        activity: qs('#activity').value,
        goal: qs('#goal').value
      };
      localStorage.setItem('rk_metrics', JSON.stringify(data));
      qs('#metricsStatus').textContent='Saved ✓';
      showMetricsPreview();
    }

    function showMetricsPreview(){
      const sex=qs('#sex').value, age=+qs('#age').value, h=+qs('#height').value, w=+qs('#weight').value, act=qs('#activity').value;
      const bmi=calcBMI(h,w), bmr=calcBMR(sex,w,h,age), tdee=calcTDEE(bmr, act);
      qs('#metricsPreview').textContent = bmi? `BMI ${bmi} · BMR ${bmr} kcal · TDEE ${tdee} kcal/day` : '';
    }

    // ---------- Exercise Library ----------
    const EX = {
      chest:[
        {n:'Barbell Bench Press', s:'4×6–8'},
        {n:'Incline Dumbbell Press', s:'3×8–10'},
        {n:'Cable Fly', s:'3×12–15'}
      ],
      back:[
        {n:'Deadlift', s:'3×3–5'},
        {n:'Lat Pulldown / Pull-up', s:'4×6–10'},
        {n:'Seated Row', s:'3×8–12'}
      ],
      legs:[
        {n:'Back Squat', s:'4×5–8'},
        {n:'Romanian Deadlift', s:'3×6–10'},
        {n:'Leg Press / Lunges', s:'3×10–12'}
      ],
      shoulders:[
        {n:'Overhead Press', s:'4×5–8'},
        {n:'Lateral Raise', s:'3×12–15'},
        {n:'Rear Delt Fly', s:'3×12–15'}
      ],
      arms:[
        {n:'Barbell Curl', s:'3×8–12'},
        {n:'Triceps Pushdown', s:'3×10–12'},
        {n:'Hammer Curl / Skullcrusher', s:'3×10–12'}
      ],
      core:[
        {n:'Plank', s:'3×45–60s'},
        {n:'Hanging Knee Raise', s:'3×10–15'},
        {n:'Cable Woodchop', s:'3×12–15/side'}
      ],
      conditioning:[
        {n:'Zone-2 Cardio', s:'30–45 min'},
        {n:'Intervals (Bike/Row)', s:'10×1 min hard / 1 min easy'}
      ],
      athletic_power:[
        {n:'Power Clean / Kettlebell Swing', s:'5×3 / 5×12'},
        {n:'Box Jump', s:'5×3–5'},
        {n:'Sprint Drills', s:'6×30–60m'}
      ],
      mobility:[
        {n:'Hip Airplane', s:'3×6/side'},
        {n:'Thoracic Opener', s:'3×10'},
        {n:'Ankle Dorsiflexion Flow', s:'5 min'}
      ],
      yoga_easy:[
        {n:'Sun Salutation A/B', s:'10–15 min'},
        {n:'Standing Sequence', s:'10 min'},
        {n:'Seated Forward Folds + Twist', s:'10 min'}
      ],
      yoga_strength:[
        {n:'Warrior Flow', s:'20 min'},
        {n:'Chair to Crow Prep', s:'10 min'},
        {n:'Core/Plank Series', s:'10 min'}
      ],
      home_none:[
        {n:'Push-ups', s:'4×AMRAP'},
        {n:'Bodyweight Squats', s:'4×20'},
        {n:'Glute Bridge', s:'3×15'},
        {n:'Plank', s:'3×45–60s'}
      ],
      home_min:[
        {n:'DB Goblet Squat', s:'4×10–12'},
        {n:'DB Row', s:'4×8–12'},
        {n:'DB Floor Press', s:'3×8–12'},
        {n:'Banded Pull-Apart', s:'3×15–20'}
      ]
    };

    function exLink(name){
      const q = encodeURIComponent(name + ' exercise form');
      return `https://www.youtube.com/results?search_query=${q}`;
    }

    // ---------- Plan Generators ----------
    function generateAutoPlan(){
      const sex=qs('#sex').value, age=+qs('#age').value, h=+qs('#height').value, w=+qs('#weight').value, act=qs('#activity').value, goal=qs('#goal').value;
      const bmi=calcBMI(h,w), bmr=calcBMR(sex,w,h,age), tdee=calcTDEE(bmr, act);
      if(!bmi||!bmr||!tdee){ alert('Please complete all metrics.'); return null; }

      // Decide split based on goal & days default = 5
      let days = 5; // could be tuned by TDEE/goal later
      const plan = { meta:{ mode:'auto', goal, bmi, bmr, tdee, days }, days:[] };
      if(goal==='muscle'){
        plan.days = [
          {name:'Day 1 · Push', ex:[...EX.chest.slice(0,2), EX.shoulders[0], EX.triceps?EX.arms[1]:EX.shoulders[1], EX.core[0]]},
          {name:'Day 2 · Pull', ex:[EX.back[0], EX.back[1], EX.back[2], EX.arms[0], EX.core[1]]},
          {name:'Day 3 · Legs', ex:[EX.legs[0], EX.legs[1], EX.legs[2], EX.core[2]]},
          {name:'Day 4 · Upper (Vol.)', ex:[EX.chest[1], EX.back[1], EX.shoulders[1], EX.arms[0]]},
          {name:'Day 5 · Lower + Core', ex:[EX.legs[0], EX.legs[2], EX.core[0], EX.conditioning[0]]}
        ];
      } else if(goal==='fatloss'){
        plan.days = [
          {name:'Day 1 · Full Body A', ex:[EX.sShoulders??EX.shoulders[0], EX.chest[1], EX.legs[0], EX.core[0], EX.conditioning[1]]},
          {name:'Day 2 · Cardio + Core', ex:[EX.conditioning[0], EX.core[1], EX.core[2]]},
          {name:'Day 3 · Full Body B', ex:[EX.back[1], EX.legs[1], EX.chest[2], EX.shoulders[1], EX.core[0]]},
          {name:'Day 4 · Cardio Intervals', ex:[EX.conditioning[1], EX.mobility[1], EX.mobility[2]]},
          {name:'Day 5 · Hypertrophy Circuit', ex:[EX.chest[2], EX.back[2], EX.legs[2], EX.shoulders[2], EX.core[2]]}
        ];
      } else if(goal==='athletic'){
        plan.days = [
          {name:'Day 1 · Power', ex:[...EX.athletic_power, EX.mobility[0]]},
          {name:'Day 2 · Strength (Lower)', ex:[EX.legs[0], EX.legs[1], EX.core[0], EX.mobility[2]]},
          {name:'Day 3 · Strength (Upper)', ex:[EX.chest[0], EX.back[1], EX.shoulders[0], EX.core[1]]},
          {name:'Day 4 · Conditioning', ex:[EX.conditioning[1], EX.mobility[1], EX.core[2]]},
          {name:'Day 5 · Recovery Mobility', ex:[...EX.mobility, EX.yoga_easy[0]]}
        ];
      } else { // recomp
        plan.days = [
          {name:'Day 1 · Upper', ex:[EX.chest[0], EX.back[1], EX.shoulders[0], EX.arms[0], EX.core[0]]},
          {name:'Day 2 · Lower', ex:[EX.legs[0], EX.legs[1], EX.core[1], EX.conditioning[0]]},
          {name:'Day 3 · Push', ex:[EX.chest[1], EX.shoulders[1], EX.arms[1], EX.core[2]]},
          {name:'Day 4 · Pull', ex:[EX.back[0], EX.back[2], EX.arms[0], EX.conditioning[1]]},
          {name:'Day 5 · Full Body', ex:[EX.chest[2], EX.legs[2], EX.back[1], EX.shoulders[2]]}
        ];
      }
      return plan;
    }

    function generateManualPlan(){
      const category = qs('#manCategory').value;
      const level = qs('#manLevel').value;
      const days = +qs('#manDays').value;
      const equip = qs('#manEquip').value;
      const plan = { meta:{ mode:'manual', category, level, days, equip }, days:[] };

      if(category==='bodybuilding'){
        if(days===6){
          plan.days = [
            {name:'Day 1 · Push', ex:[EX.chest[0], EX.chest[2], EX.shoulders[0], EX.arms[1]]},
            {name:'Day 2 · Pull', ex:[EX.back[0], EX.back[1], EX.back[2], EX.arms[0]]},
            {name:'Day 3 · Legs', ex:[EX.legs[0], EX.legs[1], EX.legs[2], EX.core[0]]},
            {name:'Day 4 · Push (vol.)', ex:[EX.chest[1], EX.shoulders[1], EX.arms[1]]},
            {name:'Day 5 · Pull (vol.)', ex:[EX.back[1], EX.back[2], EX.arms[0]]},
            {name:'Day 6 · Legs (vol.)', ex:[EX.legs[2], EX.legs[1], EX.core[2]]},
          ];
        } else if(days===4){
          plan.days = [
            {name:'Day 1 · Upper', ex:[EX.chest[0], EX.back[1], EX.shoulders[0], EX.arms[0], EX.core[0]]},
            {name:'Day 2 · Lower', ex:[EX.legs[0], EX.legs[1], EX.core[1]]},
            {name:'Day 3 · Upper (vol.)', ex:[EX.chest[1], EX.back[2], EX.shoulders[1], EX.arms[1]]},
            {name:'Day 4 · Lower (vol.)', ex:[EX.legs[2], EX.core[2], EX.conditioning[0]]},
          ];
        } else if(days===3){
          plan.days = [
            {name:'Day 1 · Full A', ex:[EX.chest[0], EX.back[1], EX.legs[0], EX.core[0]]},
            {name:'Day 2 · Full B', ex:[EX.chest[1], EX.back[2], EX.legs[1], EX.core[1]]},
            {name:'Day 3 · Full C', ex:[EX.shoulders[0], EX.legs[2], EX.arms[0], EX.core[2]]},
          ];
        } else { // 5 default
          plan.days = [
            {name:'Day 1 · Push', ex:[EX.chest[0], EX.chest[2], EX.shoulders[0], EX.arms[1]]},
            {name:'Day 2 · Pull', ex:[EX.back[0], EX.back[1], EX.back[2], EX.arms[0]]},
            {name:'Day 3 · Legs', ex:[EX.legs[0], EX.legs[1], EX.legs[2], EX.core[0]]},
            {name:'Day 4 · Upper (vol.)', ex:[EX.chest[1], EX.back[1], EX.shoulders[1], EX.arms[0]]},
            {name:'Day 5 · Lower + Core', ex:[EX.legs[0], EX.legs[2], EX.core[2]]},
          ];
        }
      } else if(category==='athletic'){
        plan.days = [
          {name:'Day 1 · Power', ex:[...EX.athletic_power]},
          {name:'Day 2 · Strength Lower', ex:[EX.legs[0], EX.legs[1], EX.core[0]]},
          {name:'Day 3 · Strength Upper', ex:[EX.chest[0], EX.back[1], EX.shoulders[0], EX.core[1]]},
          {name:'Day 4 · Conditioning', ex:[EX.conditioning[1], EX.mobility[1]]},
          {name:'Day 5 · Mobility + Core', ex:[...EX.mobility, EX.core[2]]},
        ].slice(0, days);
      } else if(category==='yoga'){
        const yogaDays = [
          {name:'Day 1 · Foundation Flow', ex:[...EX.yoga_easy]},
          {name:'Day 2 · Strength Flow', ex:[...EX.yoga_strength]},
          {name:'Day 3 · Mobility Hips/Back', ex:[EX.yoga_easy[0], EX.mobility[0], EX.mobility[1]]},
          {name:'Day 4 · Balance & Breath', ex:[EX.yoga_strength[0], EX.yoga_easy[2], EX.mobility[2]]},
          {name:'Day 5 · Restore', ex:[EX.yoga_easy[0], EX.yoga_easy[2]]},
          {name:'Day 6 · Power Yoga', ex:[EX.yoga_strength[0], EX.yoga_strength[2] || {n:'Side Plank Series', s:'10 min'}]}
        ];
        plan.days = yogaDays.slice(0, days);
      } else { // home
        const exSet = equip==='none' ? EX.home_none : EX.home_min;
        const templates = [
          {name:'Day 1 · Push/Core', ex:[exSet[2]||{n:'Push-ups', s:'4×AMRAP'}, exSet[0], EX.core[0]]},
          {name:'Day 2 · Legs', ex:[exSet[0], EX.legs[2], EX.core[1]]},
          {name:'Day 3 · Pull/Core', ex:[exSet[1], EX.back[1], EX.core[2]]},
          {name:'Day 4 · Conditioning', ex:[EX.conditioning[0], EX.mobility[1]]},
          {name:'Day 5 · Full Body', ex:[exSet[0], exSet[1], exSet[2]||{n:'Dips (Chair)', s:'3×AMRAP'}]},
          {name:'Day 6 · Mobility + Yoga', ex:[...EX.mobility, EX.yoga_easy[0]]}
        ];
        plan.days = templates.slice(0, days);
      }

      // Tweak volume by level
      if(level==='beginner'){
        plan.days = plan.days.map(d=>({ ...d, ex: d.ex.slice(0, Math.max(3, Math.ceil(d.ex.length*0.7))) }));
      } else if(level==='advanced'){
        plan.days = plan.days.map(d=>({ ...d, ex: [...d.ex, EX.core[ Math.floor(Math.random()*EX.core.length) ]] }));
      }

      return plan;
    }

    // ---------- Render ----------
    function renderPlan(plan){
      const week = qs('#week'); week.innerHTML='';
      const meta = qs('#planMeta'); meta.innerHTML='';
      if(!plan){ week.innerHTML = '<div class="p">No plan yet. Generate using the left panel.</div>'; return; }

      // Meta badges
      const m = plan.meta;
      const add = (txt, cls='badge')=>{ const span=document.createElement('span'); span.className=cls; span.textContent=txt; meta.appendChild(span); };
      add(m.mode==='auto' ? 'Mode: Auto' : `Mode: Manual`);
      if(m.goal) add('Goal: '+m.goal);
      if(m.category) add('Type: '+m.category);
      if(m.level) add('Level: '+m.level);
      if(m.days) add(m.days+ ' days/week', 'mutebadge');
      if(m.bmi) add('BMI: '+m.bmi, 'mutebadge');
      if(m.bmr) add('BMR: '+m.bmr+' kcal', 'mutebadge');
      if(m.tdee) add('TDEE: '+m.tdee+' kcal', 'mutebadge');

      // Days
      plan.days.forEach((d, idx)=>{
        const card = document.createElement('div'); card.className='day';
        const h = document.createElement('h3'); h.textContent = d.name || ('Day '+(idx+1)); card.appendChild(h);
        const list = document.createElement('div'); list.className='ex-list';
        (d.ex||[]).forEach(ex=>{
          const row = document.createElement('div'); row.className='ex';
          const info = document.createElement('div');
          const title = document.createElement('div'); title.textContent = ex.n; title.style.fontWeight='700';
          const meta = document.createElement('div'); meta.className='meta'; meta.textContent = ex.s || '';
          info.appendChild(title); info.appendChild(meta);
          const link = document.createElement('a'); link.href = exLink(ex.n); link.target='_blank'; link.rel='noopener'; link.textContent='▶ Video';
          row.appendChild(info); row.appendChild(link);
          list.appendChild(row);
        });
        card.appendChild(list);
        week.appendChild(card);
      });

      // Persist last plan in session
      sessionStorage.setItem('rk_last_plan', JSON.stringify(plan));
    }

    // ---------- Events ----------
    qsa('.tab').forEach(t=> t.addEventListener('click', e=>{
      qsa('.tab').forEach(x=>x.classList.remove('active')); e.currentTarget.classList.add('active');
      const mode = e.currentTarget.dataset.mode;
      if(mode==='auto'){ qs('#autoForm').style.display='block'; qs('#manualForm').style.display='none'; }
      else { qs('#manualForm').style.display='block'; qs('#autoForm').style.display='none'; }
    }));

    ['sex','age','height','weight','activity'].forEach(id=>{
      const el = qs('#'+id); if(el) el.addEventListener('input', showMetricsPreview);
    });

    qs('#genAuto').addEventListener('click', ()=>{ const p = generateAutoPlan(); renderPlan(p); });
    qs('#genManual').addEventListener('click', ()=>{ const p = generateManualPlan(); renderPlan(p); });
    qs('#saveMetrics').addEventListener('click', saveMetrics);

    qs('#downloadJson').addEventListener('click', ()=>{
      const plan = sessionStorage.getItem('rk_last_plan');
      if(!plan){ alert('No plan to download yet.'); return; }
      const blob = new Blob([plan], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='rk_workout_plan.json'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 5000);
    });

    qs('#resetPlan').addEventListener('click', ()=>{
      sessionStorage.removeItem('rk_last_plan');
      qs('#week').innerHTML=''; qs('#planMeta').innerHTML='';
    });

    // ---------- Init ----------
    const loaded = loadMetrics();
    if(loaded){ showMetricsPreview(); }
    const last = sessionStorage.getItem('rk_last_plan'); if(last){ try{ renderPlan(JSON.parse(last)); }catch(e){} }
  </script>
</body>
</html>
